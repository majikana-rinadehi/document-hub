---
title: "Serena MCP × Claude Code 導入メモ"
emoji: "🎠"
type: "tech"
topics: []
published: false
---


Claude Codeを使い始めてから、もっと効率的にコードを管理したいと思っていた時に[Serena MCP](https://github.com/oraios/serena)を知りました。


最初はMCP（Model Context Protocol）という用語すら馴染みがなかったのですが、実際に導入してみると開発体験が大きく変わったため、。



### 前提

- Claude Codeがインストール済み

## ステップ1：環境の準備



[Serena MCPの公式リポジトリ](https://github.com/oraios/serena)を見た時、「なんだかセットアップが複雑そう...」と思いましたが、実際はuvという便利なツールのおかげでとても簡単でした。

- 参考:
    - [GitHub - oraios/serena: A powerful coding agent toolkit providing semantic retrieval and editing capabilities (MCP server & Agno integration)](https://github.com/oraios/serena?tab=readme-ov-file#quick-start)

### uvのインストール


[公式インストールガイド](https://docs.astral.sh/uv/getting-started/installation/#installation-methods)を参考に、お好みの方法でuvをインストールします。


### Serenaの初回起動


```plain text
uvx --from git+https://github.com/oraios/serena serena start-mcp-server
```



このコマンドを実行すると、自動的にlocalhostでSerenaのダッシュボードが立ち上がります。


[http://127.0.0.1:24282/dashboard/index.html](http://127.0.0.1:24282/dashboard/index.html)


![%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2025-11-22_19.24.55.png](/images/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2025-11-22_19.24.55_0.png)

> 

初めて [http://127.0.0.1:24282/dashboard/index.html](http://127.0.0.1:24282/dashboard/index.html) にアクセスした時は「おお、ちゃんと動いてる！」と感動しました。


### Claude CodeへのMCP追加


```plain text
claude mcp add serena -- uvx --from git+https://github.com/oraios/serena serena start-mcp-server --context ide-assistant --project $(pwd)
```



このコマンドが少し長くて覚えにくいのですが、一度設定すれば次回からはClaudeコマンドを実行するだけで自動的にSerenaダッシュボードが表示されるようになります。`/mcp`コマンドでSerenaが正しく追加されているか確認できますよ。


![%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2025-11-22_19.21.15.png](/images/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2025-11-22_19.21.15_1.png)

> ▲ `/mcp` で、serena のmcpサーバに接続確認

### プロジェクトのインデックス作成


```plain text
uvx --from git+https://github.com/oraios/serena serena project index
```



このインデックス作成が地味に重要です。プロジェクトのコードベース全体を解析してくれるので、後でClaudeに質問する時の回答精度が格段に上がります。初回は時間がかかりますが、その価値は十分にあります。



## ステップ2：基本設定



基本的なセットアップは完了しましたが、実際のプロジェクトで使うにはもう少し設定が必要です。特にインデックス対象のファイルを適切に指定しないと、不要なファイルまで解析してしまい、パフォーマンスが落ちてしまいます。


### プロジェクトのインデックス対象の指定

- 対象ディレクトリの設定
- 除外パターンの設定
- ファイルタイプの指定

### 設定例（10-20行程度）


```json
{
  "include_patterns": ["src/**", "lib/**"],
  "exclude_patterns": ["node_modules/**", "*.log"],
  "file_types": ["js", "ts", "py", "go"]
}
```


### 期待される結果

- プロジェクト構造の効率的な解析
- 高速な検索・編集機能
- コンテキストに応じた適切な提案


設定ファイルの書き方は最初戸惑いましたが、基本的にはプロジェクトルートに`.serena`フォルダを作って設定ファイルを置くだけです。大規模なプロジェクトでは除外パターンをしっかり設定しないと、インデックス作成に時間がかかりすぎるので注意が必要ですね。


## ステップ3：実装



ここからが本番です。設定は完了したので、実際にSerenaを使ってコードの編集や検索を試してみましょう。最初は「本当にうまくいくのかな？」と半信半疑でしたが、使ってみるとその便利さに驚きます。



### 核となる実装コード


```python
# Serena MCP を活用したコード編集例
from serena import SemanticSearch, CodeEditor

# セマンティック検索でファイルを見つける
search = SemanticSearch(project_root="./")
results = search.find_similar("authentication logic")

# 見つかったファイルを編集
editor = CodeEditor()
for file_path in results:
    editor.edit(file_path, context="improve security")
```


### 重要なポイント（3個）

1. **セマンティック検索の活用**: 単純なファイル名検索ではなく、コードの意味を理解した検索が可能
2. **コンテキスト保持**: プロジェクト全体の構造を理解した上での編集提案
3. **効率的な編集**: 複数ファイルの一括編集や依存関係を考慮した変更

### よくあるエラーと対処法

- **インデックス未作成エラー**: プロジェクトインデックスの再作成で解決
- **パフォーマンス低下**: 除外パターンの見直しが必要
- **接続エラー**: MCPサーバーの再起動で解決することが多い


実際に使ってみて一番感動したのは、「認証まわりのコードを修正して」と自然言語で指示するだけで、プロジェクト内の関連ファイルを自動で見つけて適切に編集してくれることです。従来の grep 検索とは次元が違う体験でした。ただし、最初は思った通りに動かないこともあるので、小さなタスクから始めることをお勧めします。


## ステップ4：テスト



新しいツールを導入した後は、きちんと動作確認をしたくなりますよね。Serenaは比較的安定していますが、プロジェクトの規模や構成によって挙動が変わることもあるので、基本的な機能から順番にテストしていきましょう。


### テスト方法

1. **基本接続テスト**: Claude Code内で `/mcp` コマンドを実行
2. **検索機能テスト**: 簡単なキーワードでファイル検索を試行
3. **編集機能テスト**: 小さなコード変更を実行

### 成功の確認方法

- ダッシュボードでプロジェクト情報が正しく表示される
- セマンティック検索で期待したファイルが見つかる
- コード編集の提案が適切である

### トラブルシューティング

- **ダッシュボードが開かない**: ポート24282が使用されていないか確認
- **検索結果が空**: プロジェクトインデックスの再作成を実行
- **編集提案が不適切**: コンテキストの指定をより具体的に


テスト段階で一番つまずいたのは、プロジェクトインデックスの問題でした。大きなプロジェクトの場合、初回インデックス作成に10分以上かかることもあります。気長に待つか、対象ファイルを絞り込むことが重要ですね。また、検索精度は使い込むほど向上する印象があります。


## ステップ5：デプロイ・運用



Serenaの基本的な使い方を覚えたら、次は実際の開発フローに組み込んで継続的に使っていくことが大切です。個人的には、一度慣れてしまうとSerena無しでの開発は考えられなくなりました。


### デプロイ手順

1. **チーム共有設定**: プロジェクト設定ファイルをリポジトリに含める
2. **環境変数設定**: 必要に応じてAPIキーや設定を環境変数で管理
3. **ドキュメント化**: チームメンバー向けのセットアップガイド作成

### 監視ポイント

- インデックス更新の頻度とパフォーマンス
- 検索精度の維持
- メモリ使用量とディスク容量

### メンテナンス方法

- 定期的なインデックス再構築
- 除外パターンの見直し
- Serenaバージョンの更新


運用していて気づいたのは、プロジェクトが成長するにつれてインデックスサイズも大きくなり、検索速度が少しずつ遅くなることです。月に一度程度、不要なファイルを除外パターンに追加したり、インデックスを再構築したりするメンテナンスをお勧めします。


## まとめ



Serena MCPを導入してから、コード検索と編集の効率が大幅に向上しました。特に大規模なプロジェクトでの「あのコードってどこにあったっけ？」という悩みが解決されたのは大きな収穫です。



### 学んだこと

- MCPプロトコルの実用性と可能性
- セマンティック検索の威力
- プロジェクト全体を理解したAI支援の価値
- 継続的なインデックスメンテナンスの重要性
- チーム開発での設定共有方法

### 次に学ぶべきこと

- Serenaの高度な機能（カスタムプラグインなど）
- 他のMCPサーバーとの連携
- より効率的なワークフローの構築

### 関連リソース

- [Serena公式ドキュメント](https://github.com/oraios/serena)
- [MCP プロトコル仕様](https://spec.modelcontextprotocol.io/)
- [Claude Code 公式ガイド](https://claude.ai/code)
